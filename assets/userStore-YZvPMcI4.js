import{q as H,A as J,r as s,v as h}from"./index-5zW-ksle.js";import{b as K,T as i,A as f,c as Q,d as W,e as X,f as D,S as l,g as _,h as ee}from"./userApi--yMtzZvb.js";const te=H("userStore",()=>{const p=J(),w=s({email:"",password:""}),m=s(!1),r=s({}),L=s(!1),z=async()=>{m.value=!0;try{const e=await K(w.value);document.cookie=`typescript=${e.data.token}`,r.value=e.data.result,w.value={email:"",password:""},console.log(r.value),i.fire({icon:"success",title:"登入成功"}),p.push("/")}catch(e){console.log("登入失敗",e),f.fire({icon:"error",title:"登入失敗，請檢查您的帳號密碼"})}finally{m.value=!1}},A=()=>{document.cookie="typescript=",n.value=!1,i.fire({icon:"success",title:"已登出"}),p.push("/")},E=s(1),g=s(!1),b=s(""),x=s(""),C=s(""),U=s(""),P=s(""),t=s({year:new Date().getFullYear(),month:1,day:1}),B=h(()=>`${t.value.year}/${t.value.month}/${t.value.day}`),c=s(""),u=s(""),d=s(0),v=s(""),O=h(()=>({zipcode:d.value,detail:v.value,city:c.value,county:u.value})),k=h(()=>({name:x.value,email:C.value,password:U.value,phone:P.value,birthday:B.value,address:O.value})),T=async()=>{g.value=!0;try{await Q(k.value),i.fire({icon:"success",title:"註冊成功，請登入"}),F(),p.push("/login")}catch(e){console.log("註冊失敗",e),f.fire({icon:"error",title:"註冊失敗，請檢查您的資料"})}finally{g.value=!1}},F=()=>{E.value=1,b.value="",v.value="",c.value="",u.value="",d.value=0,t.value={year:new Date().getFullYear(),month:1,day:1}},n=s(!1),G=async()=>{try{const e=await W();n.value=e.data.status,console.log("checkUser 驗證成功",n.value)}catch{n.value=!1,console.log("checkUser 驗證失敗",n.value)}},o=s({userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""}),y=s(""),$=s(!1),I=s(!1),Y=s(!1),q=async()=>{const e=await X();r.value=e.data.result},M=async()=>{if(o.value.newPassword!==y.value){alert("密碼不一致");return}try{const e=await D(o.value);console.log("修改資料 成功",e),r.value=e.data.result,$.value=!1,i.fire({icon:"success",title:"修改資料成功"}),o.value={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""},y.value=""}catch(e){console.log("修改密码失败",e),f.fire({icon:"error",title:"修改資料失敗"})}},N=async()=>{const e={userId:o.value.userId,name:o.value.name,phone:o.value.phone,birthday:`${t.value.year}/${t.value.month}/${t.value.day}`,address:{zipcode:d.value,detail:`${c.value}${u.value}${v.value}`}};try{const a=await D(e);console.log("修改資料成功",a),r.value=a.data.result,I.value=!1,i.fire({icon:"success",title:"修改資料成功"})}catch(a){console.log("修改資料失敗",a),f.fire({icon:"error",title:"修改資料失敗"})}},R=async()=>{l.fire({title:"請輸入您的Email",input:"text",inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:async e=>{console.log(e),(await _(e)).data.result.isEmailExists?V(e):l.fire({title:"Email不存在",text:"請確認Email",icon:"error"})},allowOutsideClick:()=>!l.isLoading()})},V=async e=>{try{const a=await ee(e);console.log("已將驗證信發送到您的信箱",a),l.fire({title:"已將驗證信發送到您的信箱",text:"請設定新密碼",icon:"success",preConfirm:()=>{l.fire({title:"請輸入新密碼及驗證碼",html:`
            <label for="swal-input1">請輸入驗證碼</label>
            <input id="swal-input1" class="swal2-input">
            <label for="swal-input2">請輸入新密碼</label>
            <input id="swal-input2" class="swal2-input" type="password">
          `,inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:()=>{const Z=document.getElementById("swal-input1"),j=document.getElementById("swal-input2");console.log(j.value,Z.value)},allowOutsideClick:()=>!l.isLoading()})}})}catch(a){console.log("generateEmailCode 失敗",a),l.fire({title:"發送驗證碼失敗",icon:"error"})}},S=async()=>{try{await S(),i.fire({icon:"success",title:"重置密碼郵件已發送，請檢查您的郵箱。"})}catch{}};return{loginLoading:m,loginData:w,userInfo:r,rememberMe:L,login:z,logout:A,signupLoading:g,signupName:x,signupEmail:C,signupPassword:U,passwordConfirm:b,signupPhone:P,signupData:k,signupStep:E,birthdate:t,selectedCity:c,detailedAddress:v,selectedDistrict:u,selectedZip:d,signup:T,isChecked:n,checkUser:G,editUserData:o,newPassword2:y,showEditPassword:$,showEditUserInfo:I,userStatus:Y,getUser:q,editUserPass:M,editUserInfo:N,verifyEmail:R,forgotPassword:S}});export{te as u};
