import{q as J,A as K,r as s,v as h}from"./index-DsCx5gKH.js";import{b as Q,T as i,A as p,c as W,d as X,e as _,f as D,S as l,g as ee,h as se}from"./userApi-dxlgwfeL.js";const oe=J("userStore",()=>{const v=K(),m=s({email:"",password:""}),w=s(!1),r=s({}),L=s({name:"",phone:"",email:""}),z=s(!1),A=async()=>{w.value=!0;try{const e=await Q(m.value);document.cookie=`typescript=${e.data.token}`,r.value=e.data.result,m.value={email:"",password:""},console.log(r.value),i.fire({icon:"success",title:"登入成功"}),v.push("/")}catch(e){console.log("登入失敗",e),p.fire({icon:"error",title:"登入失敗，請檢查您的帳號密碼"})}finally{w.value=!1}},T=()=>{document.cookie="typescript=",n.value=!1,i.fire({icon:"success",title:"已登出"}),v.push("/")},E=s(1),g=s(!1),b=s(""),x=s(""),C=s(""),U=s(""),P=s(""),t=s({year:new Date().getFullYear(),month:1,day:1}),B=h(()=>`${t.value.year}/${t.value.month}/${t.value.day}`),c=s(""),u=s(""),d=s(0),f=s(""),O=h(()=>({zipcode:d.value,detail:f.value,city:c.value,county:u.value})),k=h(()=>({name:x.value,email:C.value,password:U.value,phone:P.value,birthday:B.value,address:O.value})),F=async()=>{g.value=!0;try{await W(k.value),i.fire({icon:"success",title:"註冊成功，請登入"}),G(),v.push("/login")}catch(e){console.log("註冊失敗",e),p.fire({icon:"error",title:"註冊失敗，請檢查您的資料"})}finally{g.value=!1}},G=()=>{E.value=1,b.value="",f.value="",c.value="",u.value="",d.value=0,t.value={year:new Date().getFullYear(),month:1,day:1}},n=s(!1),Y=async()=>{try{const e=await X();n.value=e.data.status,console.log("checkUser 驗證成功",n.value)}catch{n.value=!1,console.log("checkUser 驗證失敗",n.value)}},o=s({userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""}),y=s(""),I=s(!1),$=s(!1),q=s(!1),M=async()=>{const e=await _();r.value=e.data.result},N=async()=>{if(o.value.newPassword!==y.value){alert("密碼不一致");return}try{const e=await D(o.value);console.log("修改資料 成功",e),r.value=e.data.result,I.value=!1,i.fire({icon:"success",title:"修改資料成功"}),o.value={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""},y.value=""}catch(e){console.log("修改密码失败",e),p.fire({icon:"error",title:"修改資料失敗"})}},R=async()=>{const e={userId:o.value.userId,name:o.value.name,phone:o.value.phone,birthday:`${t.value.year}/${t.value.month}/${t.value.day}`,address:{zipcode:d.value,detail:`${c.value}${u.value}${f.value}`}};try{const a=await D(e);console.log("修改資料成功",a),r.value=a.data.result,$.value=!1,i.fire({icon:"success",title:"修改資料成功"})}catch(a){console.log("修改資料失敗",a),p.fire({icon:"error",title:"修改資料失敗"})}},V=async()=>{l.fire({title:"請輸入您的Email",input:"text",inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:async e=>{console.log(e),(await ee(e)).data.result.isEmailExists?Z(e):l.fire({title:"Email不存在",text:"請確認Email",icon:"error"})},allowOutsideClick:()=>!l.isLoading()})},Z=async e=>{try{const a=await se(e);console.log("已將驗證信發送到您的信箱",a),l.fire({title:"已將驗證信發送到您的信箱",text:"請設定新密碼",icon:"success",preConfirm:()=>{l.fire({title:"請輸入新密碼及驗證碼",html:`
            <label for="swal-input1">請輸入驗證碼</label>
            <input id="swal-input1" class="swal2-input">
            <label for="swal-input2">請輸入新密碼</label>
            <input id="swal-input2" class="swal2-input" type="password">
          `,inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:()=>{const j=document.getElementById("swal-input1"),H=document.getElementById("swal-input2");console.log(H.value,j.value)},allowOutsideClick:()=>!l.isLoading()})}})}catch(a){console.log("generateEmailCode 失敗",a),l.fire({title:"發送驗證碼失敗",icon:"error"})}},S=async()=>{try{await S(),i.fire({icon:"success",title:"重置密碼郵件已發送，請檢查您的郵箱。"})}catch{}};return{loginLoading:w,loginData:m,userInfo:r,userInfoTemp:L,rememberMe:z,login:A,logout:T,signupLoading:g,signupName:x,signupEmail:C,signupPassword:U,passwordConfirm:b,signupPhone:P,signupData:k,signupStep:E,birthdate:t,selectedCity:c,detailedAddress:f,selectedDistrict:u,selectedZip:d,signup:F,isChecked:n,checkUser:Y,editUserData:o,newPassword2:y,showEditPassword:I,showEditUserInfo:$,userStatus:q,getUser:M,editUserPass:N,editUserInfo:R,verifyEmail:V,forgotPassword:S}});export{oe as u};
