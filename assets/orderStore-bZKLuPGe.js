import{q,u as J,A as _,r as t,v as j}from"./index-srPLUe_8.js";import{a,T as n,A as d}from"./userApi-u09h4eQQ.js";import{f as h}from"./format-ue8EY1kP.js";import{u as B}from"./userStore-e7CF8tCK.js";const W=q("order",()=>{const D=J(),M=_(),u=B(),v=t(""),I=t({...{checkInDate:"",checkOutDate:"",peopleNum:0,roomId:{name:"",description:"",imageUrl:"",imageUrlList:[],areaInfo:"",bedInfo:"",maxPeople:0,price:0,facilityInfo:[{title:"平面電視",isProvide:!0},{title:"吹風機",isProvide:!0},{title:"冰箱",isProvide:!0},{title:"熱水壺",isProvide:!0},{title:"檯燈",isProvide:!0},{title:"衣櫃",isProvide:!0},{title:"除濕機",isProvide:!0},{title:"浴缸",isProvide:!0},{title:"書桌",isProvide:!0},{title:"音響",isProvide:!0}],amenityInfo:[{title:"衛生紙",isProvide:!0},{title:"拖鞋",isProvide:!0},{title:"沐浴用品",isProvide:!0},{title:"清潔用品",isProvide:!0},{title:"刮鬍刀",isProvide:!0},{title:"吊衣架",isProvide:!0},{title:"浴巾",isProvide:!0},{title:"刷牙用品",isProvide:!0},{title:"罐裝水",isProvide:!0},{title:"梳子",isProvide:!0}]},userInfo:{name:"",phone:"",email:"",address:{zipcode:0,detail:""}}}}),s=t({start:"",end:""}),l=t(2),y=t({name:"",phone:"",email:""}),m=t(""),p=t(""),g=t(!1),k=async()=>{const e={checkInDate:h.getLocalDateFormat(new Date(s.value.start)),checkOutDate:h.getLocalDateFormat(new Date(s.value.end)),peopleNum:l.value,roomId:D.params.id,userInfo:{name:u.userInfoTemp.name,phone:u.userInfoTemp.phone,email:u.userInfoTemp.email,address:{zipcode:parseInt(m.value),detail:p.value}}};try{g.value=!0;const r=await a.post("/orders/",e);console.log("createOrder 新增成功",r),w(),M.push(`/booking-complete/${r.data.result._id}`),c(),n.fire({title:"已建立訂單",icon:"success"})}catch(r){console.log("createOrder 失敗",r),d.fire({title:"請填寫正確格式",icon:"error"})}finally{g.value=!1}},c=()=>{s.value={start:"",end:""},l.value=2,y.value={name:"",phone:"",email:""},m.value="",p.value=""},o=t(null),N=async()=>{try{console.log("getFrontOrder 取得資料",o.value);const e=await a.get(`/orders/${D.params.id}`);o.value=e.data.result}catch(e){console.log("getFrontOrder 失敗",e)}},T=j(()=>o.value?h.getNightNum(o.value.checkInDate,o.value.checkOutDate)*o.value.roomId.price:0),f=t([]),S=async()=>{try{const e=await a.get("/orders/");f.value=e.data.result}catch{}},L=async e=>{try{await a.delete(`/orders/${e}`),S(),n.fire({icon:"success",title:"成功刪除訂單"})}catch(r){console.log("deleteFrontOrder 失敗",r),d.fire({icon:"error",title:"請重新再試一次"})}},O=async()=>{try{const e=await a.get("/admin/orders/");f.value=e.data.result}catch(e){console.log("getOrders 失敗",e)}},$=async()=>{try{await a.put(`/admin/orders/${v.value}`,I.value),n.fire({icon:"success",title:"更新訂單成功"}),O()}catch(e){console.log("editOrder 失敗",e),d.fire({icon:"error",title:"更新失敗，請稍後再試一次"})}},b=async()=>{try{await a.delete(`/admin/orders/${v.value}`),n.fire({icon:"success",title:"成功刪除訂單"}),O()}catch(e){console.log("deleteOrder 失敗",e),d.fire({icon:"error",title:"刪除失敗，請稍後再試一次"})}},x=()=>{localStorage.setItem("storagePeople",l.value.toString())},A=()=>{const e=localStorage.getItem("storageDate"),r=JSON.parse(e),F=localStorage.getItem("storagePeople");r&&F&&(s.value=r,l.value=Number(F))},w=()=>{localStorage.clear()},i=t(!1),U=()=>{i.value=!0},z=()=>{i.value=!1,c()},R=()=>{i.value=!i.value},P=t(!1);return{tempOrder:I,resetTempOrder:c,editOrderId:v,bookingDate:s,peopleNum:l,userInfo:y,selectDistrict:m,addressDetail:p,isLoading:g,orderList:f,getFrontOrder:N,createOrder:k,order:o,getFrontOrders:S,totalPrice:T,deleteFrontOrder:L,getOrders:O,editOrder:$,deleteOrder:b,setStoragePeople:x,getStorageData:A,cleanStorageData:w,showOrderModal:i,openOrderModal:U,closeOrderModal:z,toggleModal:R,showDelModal:P,openOrderDelModal:()=>{P.value=!0},closeOrderDelModal:()=>{P.value=!1,c()}}});export{W as u};
