import{J as j,m as F,r as o,H as l}from"./index-uIhorUpP.js";import{T as $,A as b,S as u}from"./swal-MzZ19o4Z.js";const n="https://freyja-g4ow.onrender.com",N=j("userStore",()=>{const d=F(),p=o({email:"",password:""}),i=o({}),C=o(!1),P=()=>{const s=`${n}/api/v1/user/login`;l.post(s,p.value).then(e=>{console.log("login 成功",e);const{token:t}=e.data;document.cookie=`typescript=${t}`,l.defaults.headers.common.Authorization=t,i.value=e.data.result,p.value={email:"",password:""},console.log(i.value),$.fire({icon:"success",title:"登入成功"}),d.push("/")}).catch(e=>{console.log("login 失敗",e),b.fire({icon:"error",title:"登入失敗"})})},z=()=>{document.cookie='typescript=""',y.value=!1,d.push("/")},I=o(1),a=o({name:"",email:"",password:"",phone:"",birthday:"",address:{zipcode:0,detail:"",city:"",county:""}}),E=o(""),c=o({year:new Date().getFullYear(),month:1,day:1}),h=o(""),v=o(""),g=o(0),f=o(""),x=()=>{a.value.address.zipcode=g.value,a.value.address.city=h.value,a.value.address.county=v.value,a.value.address.detail=f.value,a.value.birthday=`${c.value.year}/${c.value.month}/${c.value.day}`,console.log(a.value.address,a.value.birthday);const s=`${n}/api/v1/user/signup`;l.post(s,a.value).then(e=>{console.log(e),a.value={name:"",email:"",password:"",phone:"",birthday:"",address:{zipcode:0,detail:"",city:"",county:""}},d.push("/")}).catch(e=>{console.log(e),alert(e.response.data.message)})},m=o(!1),A=async()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)typescript\s*=\s*([^;]*).*$)|^.*$/,"$1");l.defaults.headers.common.Authorization=s;const e=`${n}/api/v1/user/check`;l.get(e).then(t=>{console.log("checkUser 驗證成功",t),m.value=!0}).catch(t=>{console.log("checkUser 驗證失敗",t)})},r=o({userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""}),w=o(""),U=o(!1),k=o(!1),y=o(!1),S=async()=>{const s=`${n}/api/v1/user`;l.get(s).then(e=>{console.log("getUser 成功",e),i.value=e.data.result,y.value=e.data.status}).catch(e=>{console.log("getUser 失敗",e)})},D=async()=>{if(r.value.newPassword!==w.value){alert("密碼不一致");return}const s=`${n}/api/v1/user`;l.put(s,r.value).then(e=>{console.log("修改資料 成功",e),i.value=e.data.result,U.value=!1,$.fire({icon:"success",title:"修改資料成功"}),r.value={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""},w.value=""}).catch(e=>{console.log("login 失敗",e),b.fire({icon:"error",title:"修改資料失敗"})})},L=async()=>{const s={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""}};s.userId=r.value.userId,s.name=r.value.name,s.phone=r.value.phone,s.birthday=`${c.value.year}/${c.value.month}/${c.value.day}`,s.address.zipcode=g.value,s.address.detail=`${h.value}${v.value}${f.value}`,console.log(s);const e=`${n}/api/v1/user`;l.put(e,s).then(t=>{console.log("修改資料 成功",t),i.value=t.data.result,k.value=!1,$.fire({icon:"success",title:"修改資料成功"})}).catch(t=>{console.log("修改資料失敗",t),b.fire({icon:"error",title:"修改資料失敗"})})},T=async()=>{u.fire({title:"請輸入您的Email",input:"text",inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:async s=>{console.log(s),B(s)},allowOutsideClick:()=>!u.isLoading()})},B=async s=>{const e=`${n}/api/v1/verify/generateEmailCode`;l.post(e,s).then(t=>{console.log("已將驗證信發送到您的信箱",t),u.fire({title:"已將驗證信發送到您的信箱",text:"請設定新密碼",icon:"success",preConfirm:()=>{u.fire({title:"請輸入新密碼及驗證碼",html:`
            <label for="swal-input1">請輸入驗證碼</label>
            <input id="swal-input1" class="swal2-input">
            <label for="swal-input2">請輸入新密碼</label>
            <input id="swal-input2" class="swal2-input" type="password">
          `,inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:()=>{const O=document.getElementById("swal-input1"),R=document.getElementById("swal-input2");console.log(R.value,O.value)},allowOutsideClick:()=>!u.isLoading()})}})}).catch(t=>{console.log("checkUser 驗證失敗",t),u.fire({title:"驗證失敗，請確認Email",text:t.response.data.message,icon:"error"})})};return{loginData:p,userInfo:i,rememberMe:C,login:P,logout:z,signupData:a,signupStep:I,passwordConfirm:E,birthdate:c,selectedCity:h,detailedAddress:f,selectedDistrict:v,selectedZip:g,signup:x,isChecked:m,checkUser:A,editUserData:r,newPassword2:w,showEditPassword:U,showEditUserInfo:k,userStatus:y,getUser:S,editUserPass:D,editUserInfo:L,verifyEmail:T,forgotPassword:async()=>{const s=`${n}/api/v1/user/forgot`;l.get(s,{}).then(e=>{console.log("checkUser 驗證成功",e),m.value=!0}).catch(e=>{console.log("checkUser 驗證失敗",e)})}}});export{N as u};
