import{J as P,l as T,m as b,r as t,M as g,H as a}from"./index-vuRMftlT.js";import{T as A,A as M}from"./swal-MzZ19o4Z.js";var U={VITE_URL:"https://freyja-g4ow.onrender.com",BASE_URL:"/side-project-booking/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:s}=U,x=P("order",()=>{const u=T(),$=b(),k=t(!1),p={roomId:"",checkInDate:"",checkOutDate:"",peopleNum:0,userInfo:{name:"",phone:"",email:"",address:{zipcode:0,detail:""}}},c=t({start:"",end:""}),n=t(2),d=t({name:"",phone:"",email:""}),m=t(""),v=t(""),h=t({...p}),F=async()=>{const o={roomId:u.params.id,checkInDate:g.getLocalDateFormat(new Date(c.value.start)),checkOutDate:g.getLocalDateFormat(new Date(c.value.end)),peopleNum:n.value,userInfo:{name:d.value.name,phone:d.value.phone,email:d.value.email,address:{zipcode:parseInt(m.value),detail:v.value}}};try{const e=`${s}/api/v1/orders/`,r=await a.post(e,o);console.log("createOrder 新增成功",r),O(),S(),$.push(`/booking-complete/${r.data.result._id}`),O(),A.fire({title:"已建立訂單",icon:"success"})}catch(e){console.log("createOrder 失敗",e),M.fire({title:"資料有誤，請稍後再試一次",icon:"error"})}},O=()=>{h.value={...p}},l=t(),D=t({}),f=t(0),_=async()=>{try{const o=`${s}/api/v1/orders/${u.params.id}`,e=await a.get(o);l.value=e.data.result,d.value=e.data.result.userInfo,D.value=e.data.result.roomId,f.value=g.getNightNum(l.value.checkInDate,l.value.checkOutDate)*l.value.roomId.price,console.log("getFrontOrder 取得資料",l.value)}catch(o){console.log("getFrontOrder 失敗",o)}},i=t(null),w=async()=>{try{const o=`${s}/api/v1/orders/`,e=await a.get(o);i.value=e.data.result,console.log("取得所有訂單",i.value)}catch(o){console.log("getFrontOrders 失敗",o)}},y=()=>{const o=`${s}/api/v1/order/${u.params.id}`;a.delete(o).then(e=>{console.log(e)}).catch(e=>{console.log(e)})},I=()=>{const o=`${s}/api/v1/admin/orders/`;a.get(o).then(e=>{console.log("getOrder 訂單列表",e),i.value=e.data.result}).catch(e=>{console.log(e)})},N=()=>{const o=`${s}/api/v1/admin/orders/${u.params.id}`;a.put(o).then(e=>{console.log(e)}).catch(e=>{console.log(e)})},R=o=>{const e=`${s}/api/v1/admin/orders/${o}`;a.delete(e).then(r=>{console.log("刪除成功",r),I()}).catch(r=>{console.log(r)})},L=()=>{localStorage.setItem("storagePeople",n.value.toString())},E=()=>{const o=localStorage.getItem("storageDate"),e=JSON.parse(o),r=localStorage.getItem("storagePeople");console.log(e,r),e&&r&&(c.value=e,n.value=Number(r)),console.log(c.value,n.value)},S=()=>{localStorage.clear()};return{showOrderModal:k,bookingDate:c,peopleNum:n,userInfo:d,selectDistrict:m,addressDetail:v,tempOrder:h,createOrder:F,orderList:i,getFrontOrder:_,order:l,roomId:D,getFrontOrders:w,totalPrice:f,deleteFrontOrder:y,getOrders:I,editOrder:N,deleteOrder:R,setStoragePeople:L,getStorageData:E,cleanStorageData:S}});export{x as u};
