import{q as z,r as w,N as $,s as N,b as T,e as p,f as g,g as e,t as F,c as t,h as c,i as E,n as S,k as V,d as L,j as v,M as q,o as I,F as A,m as R,p as B}from"./index-76dnDRcX.js";import{T as j,A as D}from"./userApi-YNycpMYI.js";import{u as G}from"./userStore-Ie69Ua6O.js";const J=z("foodStore",()=>{const k={title:"",description:"",image:"",diningTime:""},a=w(JSON.parse(JSON.stringify(k))),d=()=>{a.value=JSON.parse(JSON.stringify(k))},s=w(null),f=async()=>{try{console.log("getFood");const o=await $.get("/admin/culinary/");s.value=o.data.result,console.log("getFoods 已取得",o)}catch(m){console.log("getFoods 取得失敗",m)}},x=()=>{$.post("/admin/culinary/",a.value).then(o=>{console.log(o),j.fire({icon:"success",title:`已新增 ${o.data.result.title}`}),f()}).catch(o=>{console.log(o),D.fire({icon:"error",title:"新增失敗，請稍後再試一次"})})},l=w(""),h=w(""),n=()=>{const m=`/admin/culinary/${h.value}`;$.put(m,a.value).then(o=>{console.log("editFood 已更新",o),j.fire({icon:"success",title:`${o.data.result.title} 已更新`}),f()}).catch(o=>{console.log("editFood 更新失敗",o),D.fire({icon:"error",title:"更新失敗，請稍後再試一次"})})},_=()=>{const m=`/admin/culinary/${h.value}`;$.delete(m).then(o=>{console.log("deleteFood 已刪除",o),j.fire({icon:"success",title:`已刪除 ${o.data.result.title}`}),f()}).catch(o=>{console.log("deleteFood 刪除失敗",o),D.fire({icon:"error",title:"刪除失敗，請稍後再試一次"})})},b=()=>{$.get("/home/culinary/").then(o=>{console.log("getFrontFoods 已取得美食",o),s.value=o.data.result}).catch(o=>{console.log("getFrontFoods 失敗",o)})},M=async()=>{try{const o=await $.get("/culinary/");a.value=o.data.result,console.log("getFrontFood 已取得單一美食",o)}catch(m){console.log(m)}},r=w(!1),u=()=>{r.value=!0},O=()=>{r.value=!1,d()},C=()=>{r.value=!r.value},y=w(!1);return{tempFood:a,resetTempFood:d,foodList:s,getFoods:f,createFood:x,updateFoodType:l,editFoodId:h,editFood:n,deleteFood:_,getFrontFoods:b,getFrontFood:M,showFoodModal:r,openFoodModal:u,closeFoodModal:O,toggleModal:C,showDelModal:y,openFoodDelModal:()=>{y.value=!0},closeFoodDelModal:()=>{y.value=!1,d()}}}),H={class:"fixed top-0 left-0 w-full h-full bg-neutral-100/50 backdrop-blur-sm flex justify-center items-center"},K={"data-aos":"fade-up","data-aos-delay":"50","data-aos-duration":"300",class:"bg-white w-full md:w-2/3 xl:w-1/3 h-full md:h-fit md:max-h-[80vh] xl:max-h-[70vh] md:rounded-4 overflow-scroll duration-500 ease-in"},P={class:"sticky top-0 px-5 py-4 z-10 border-b border-primary flex justify-between bg-primary-40 text-primary"},Q={class:"text-5"},W={class:"p-4 flex flex-col gap-4"},X=e("label",{for:"food-title",class:"font-bold"},"名稱",-1),Y=e("label",{for:"food-diningTime",class:"font-bold"},"供應時間",-1),Z=e("label",{for:"food-description",class:"font-bold"},"內容",-1),ee=e("label",{for:"food-image",class:"font-bold"},"圖片",-1),te=["src"],oe={class:"bg-white sticky bottom-0 z-10 border-t border-primary-60 p-4 flex gap-2 justify-end"},se={type:"submit",class:"btn btn-primary"},le={__name:"FoodModal",setup(k){const a=J(),{updateFoodType:d,tempFood:s}=N(a),f=a.createFood,x=a.editFood,l=a.closeFoodModal;return(h,n)=>{const _=T("VField"),b=T("ErrorMessage"),M=T("VForm");return p(),g("div",H,[e("div",K,[e("div",P,[e("h1",Q,F(t(d)==="create"?"新增":"編輯")+"美饌",1),e("span",{class:"material-icons cursor-pointer",onClick:n[0]||(n[0]=r=>t(l)())},"close")]),c(M,{class:"flex flex-col",onSubmit:n[6]||(n[6]=r=>(t(d)==="create"?t(f)():t(x)(),t(l)()))},{default:E(({errors:r})=>[e("div",W,[e("div",null,[X,c(_,{type:"text",id:"food-title",name:"名稱",class:S([{"is-invalid":r.名稱},"form-input"]),rules:"required",modelValue:t(s).title,"onUpdate:modelValue":n[1]||(n[1]=u=>t(s).title=u),placeholder:"請輸入名稱"},null,8,["class","modelValue"]),c(b,{name:"名稱",class:"text-alert-100 text-3h"})]),e("div",null,[Y,c(_,{type:"text",id:"food-diningTime",name:"供應時間",class:S([{"is-invalid":r.供應時間},"form-input"]),rules:"required",modelValue:t(s).diningTime,"onUpdate:modelValue":n[2]||(n[2]=u=>t(s).diningTime=u),placeholder:"請輸入供應時間"},null,8,["class","modelValue"]),c(b,{name:"供應時間",class:"text-alert-100 text-3h"})]),e("div",null,[Z,c(_,{as:"textarea",id:"food-description",name:"內容",class:S([{"is-invalid":r.內容},"form-input"]),rules:"required",modelValue:t(s).description,"onUpdate:modelValue":n[3]||(n[3]=u=>t(s).description=u),placeholder:"請輸入內容"},null,8,["class","modelValue"]),c(b,{name:"內容",class:"text-alert-100 text-3h"})]),e("div",null,[ee,c(_,{type:"text",id:"food-image",name:"圖片",class:S([{"is-invalid":r.圖片},"form-input"]),rules:"required",modelValue:t(s).image,"onUpdate:modelValue":n[4]||(n[4]=u=>t(s).image=u),placeholder:"請輸入圖片連結"},null,8,["class","modelValue"]),c(b,{name:"圖片",class:"text-alert-100 text-3h"}),t(s).image?(p(),g("img",{key:0,src:t(s).image,class:"mt-2 rounded-2 h-[200px] w-full object-cover",alt:""},null,8,te)):V("",!0)])]),e("div",oe,[e("button",{type:"button",class:"btn btn-secondary",onClick:n[5]||(n[5]=u=>t(l)())},"取消"),e("button",se,"確認"+F(t(d)==="create"?"新增":"更新"),1)])]),_:1})])])}}},ne={class:"w-full h-[30vh] lg:h-[24vh] flex justify-center items-center px-6"},ae={class:"text-5 font-bold text-justify"},de={class:"text-primary-100"},re={class:"p-3 flex gap-4 border-t border-primary-60"},ie=L({__name:"FoodDelete",setup(k){const a=J(),{tempFood:d}=N(a),s=a.closeFoodDelModal,f=a.deleteFood;return(x,l)=>(p(),g("div",{onClick:l[3]||(l[3]=q(h=>t(s)(),["stop"])),class:"fixed top-0 left-0 w-full h-full bg-black/40 backdrop-blur-sm flex justify-center items-end lg:items-center"},[e("div",{onClick:l[2]||(l[2]=q(()=>{},["stop"])),class:"bg-white rounded-t-[16px] lg:rounded-[16px] w-full lg:w-[36vw]"},[e("div",ne,[e("p",ae,[v(" 刪除後無法復原，確定要刪除 "),e("span",de,F(t(d).title),1),v(" 嗎？ ")])]),e("div",re,[e("button",{class:"btn btn-secondary w-full",onClick:l[0]||(l[0]=h=>t(s)())},"關閉視窗"),e("button",{class:"btn btn-primary w-full",onClick:l[1]||(l[1]=h=>(t(f)(),t(s)()))},"刪除")])])]))}}),ce={class:"p-10 flex flex-col gap-6"},ue={class:"flex items-end"},pe=e("h1",{class:"text-7"},"美饌管理",-1),fe={key:0,class:"font-bold ms-2"},me={class:"text-primary-100"},he={key:0,class:"text-primary-100 text-7 font-bold w-full h-[70vh] flex justify-center items-center"},ge={key:1,class:"w-full admin-table"},_e=e("thead",null,[e("tr",{class:"border-y border-primary-60"},[e("th",{class:"text-start",width:"15%"}),e("th",{class:"text-center",width:"10%"},"名稱"),e("th",{class:"text-center",width:"30%"},"內容"),e("th",{class:"text-center",width:"20%"},"供應時間"),e("th",{class:"text-center",width:"25%"},"管理")])],-1),be=["src","alt"],ye={class:"text-center"},ve={class:"text-justify"},xe={class:"text-center"},Fe={class:"flex flex-wrap justify-center gap-2"},we=["onClick"],$e=["onClick"],Ce=L({__name:"CulinaryAdmin",setup(k){const a=J(),{foodList:d,tempFood:s,editFoodId:f,updateFoodType:x,showFoodModal:l,showDelModal:h}=N(a),n=a.getFoods,_=G(),{isChecked:b}=N(_),M=_.checkUser,r=()=>{b.value&&n()},u=async()=>{await M(),r()};return I(()=>{u()}),(O,C)=>{const y=T("font-awesome-icon");return p(),g(A,null,[e("div",ce,[e("div",ue,[pe,t(d)?(p(),g("p",fe,[v("(共 "),e("span",me,F(t(d).length),1),v(" 筆資料)")])):V("",!0)]),e("button",{class:"btn btn-primary ms-auto",onClick:C[0]||(C[0]=i=>(l.value=!0,x.value="create"))},[c(y,{icon:"fa-solid fa-plus",class:"me-2"}),v(" 新增美饌 ")]),t(d)?(p(),g("table",ge,[_e,e("tbody",null,[(p(!0),g(A,null,R(t(d),i=>(p(),g("tr",{key:i._id,class:"border-b border-primary-60 hover:bg-primary-40"},[e("th",null,[i.image?(p(),g("img",{key:0,class:"w-full h-[120px] object-cover rounded-2",src:i.image,alt:i.title},null,8,be)):V("",!0)]),e("th",ye,F(i.title),1),e("th",ve,F(i.description),1),e("th",xe,F(i.diningTime),1),e("th",null,[e("div",Fe,[e("button",{onClick:U=>(l.value=!0,s.value=JSON.parse(JSON.stringify(i)),x.value="edit",f.value=i._id),class:"btn btn-primary text-4h"},[c(y,{icon:"fa-solid fa-pencil",class:"me-2"}),v(" 編輯 ")],8,we),e("button",{onClick:U=>(h.value=!0,s.value=JSON.parse(JSON.stringify(i)),f.value=i._id),class:"btn text-primary-100 text-4h hover:text-primary border border-primary-100 hover:border-primary bg-transparent hover:bg-primary-60"},[c(y,{icon:"fa-solid fa-trash-can",class:"me-2"}),v(" 刪除 ")],8,$e)])])]))),128))])])):(p(),g("div",he,[c(y,{icon:"fa-solid fa-utensils",class:"me-2"}),v(" 目前還沒有任何美食，快去新增吧！ ")]))]),t(l)?(p(),B(le,{key:0})):V("",!0),t(h)?(p(),B(ie,{key:1})):V("",!0)],64)}}});export{Ce as default};
