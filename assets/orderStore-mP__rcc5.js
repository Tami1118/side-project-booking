import{q as T,u as x,B as A,r,v as U,x as p,L as s}from"./index-wIY0i8YO.js";import{T as I,A as $}from"./swal-MzZ19o4Z.js";var V={VITE_URL:"https://freyja-g4ow.onrender.com",BASE_URL:"/side-project-booking/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:l}=V,M=T("order",()=>{const i=x(),F=A(),k=r(!1),m={checkInDate:"",checkOutDate:"",peopleNum:0,roomId:"",userInfo:{name:"",phone:"",email:"",address:{zipcode:0,detail:""}}},v=r({...m}),c=r({start:"",end:""}),n=r(2),d=r({name:"",phone:"",email:""}),h=r(""),O=r(""),g=r(!1),L=async()=>{const o={checkInDate:p.getLocalDateFormat(new Date(c.value.start)),checkOutDate:p.getLocalDateFormat(new Date(c.value.end)),peopleNum:n.value,roomId:i.params.id,userInfo:{name:d.value.name,phone:d.value.phone,email:d.value.email,address:{zipcode:parseInt(h.value),detail:O.value}}};try{g.value=!0;const e=`${l}/api/v1/orders/`,t=await s.post(e,o);g.value=!1,console.log("createOrder 新增成功",t),S(),_(),F.push(`/booking-complete/${t.data.result._id}`),I.fire({title:"已建立訂單",icon:"success"})}catch(e){console.log("createOrder 失敗",e),$.fire({title:"資料有誤，請稍後再試一次",icon:"error"})}},_=()=>{v.value={...m}},a=r(null),w=async()=>{try{const o=`${l}/api/v1/orders/${i.params.id}`,e=await s.get(o);a.value=e.data.result,console.log("getFrontOrder 取得資料",a.value)}catch(o){console.log("getFrontOrder 失敗",o)}},y=U(()=>a.value?p.getNightNum(a.value.checkInDate,a.value.checkOutDate)*a.value.roomId.price:0),u=r([]),f=async()=>{try{const o=`${l}/api/v1/orders/`,e=await s.get(o);u.value=e.data.result,console.log("getFrontOrders 取得所有訂單",u.value)}catch(o){console.log("getFrontOrders 失敗",o)}},N=o=>{const e=`${l}/api/v1/orders/${o}`;s.delete(e).then(t=>{console.log(t),f(),I.fire({icon:"success",title:"成功刪除訂單"})}).catch(t=>{console.log(t),$.fire({icon:"error",title:"請重新再試一次"})})},D=()=>{const o=`${l}/api/v1/admin/orders/`;s.get(o).then(e=>{console.log("getOrder 訂單列表",e),u.value=e.data.result}).catch(e=>{console.log(e)})},R=()=>{const o=`${l}/api/v1/admin/orders/${i.params.id}`;s.put(o).then(e=>{console.log(e)}).catch(e=>{console.log(e)})},b=o=>{const e=`${l}/api/v1/admin/orders/${o}`;s.delete(e).then(t=>{console.log("刪除成功",t),D()}).catch(t=>{console.log(t)})},E=()=>{localStorage.setItem("storagePeople",n.value.toString())},P=()=>{const o=localStorage.getItem("storageDate"),e=JSON.parse(o),t=localStorage.getItem("storagePeople");console.log(e,t),e&&t&&(c.value=e,n.value=Number(t)),console.log(c.value,n.value)},S=()=>{localStorage.clear()};return{showOrderModal:k,bookingDate:c,peopleNum:n,userInfo:d,selectDistrict:h,addressDetail:O,tempOrder:v,isLoading:g,createOrder:L,orderList:u,getFrontOrder:w,order:a,getFrontOrders:f,totalPrice:y,deleteFrontOrder:N,getOrders:D,editOrder:R,deleteOrder:b,setStoragePeople:E,getStorageData:P,cleanStorageData:S,onSubmit:()=>{console.log("123")}}});export{M as u};
