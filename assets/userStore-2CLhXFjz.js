import{v as j,B as F,r as o,L as l}from"./index-IWXpTEn3.js";import{T as $,A as b,S as d}from"./swal-MzZ19o4Z.js";const n="https://freyja-g4ow.onrender.com",Y=j("userStore",()=>{const m=F(),w=o({email:"",password:""}),u=o({}),z=o(!1),I=()=>{const s=`${n}/api/v1/user/login`;l.post(s,w.value).then(e=>{console.log("login 成功",e);const{token:t}=e.data;document.cookie=`typescript=${t}`,l.defaults.headers.common.Authorization=t,u.value=e.data.result,w.value={email:"",password:""},console.log(u.value),$.fire({icon:"success",title:"登入成功"}),m.push("/")}).catch(e=>{console.log("login 失敗",e),b.fire({icon:"error",title:"登入失敗"})})},E=()=>{document.cookie='typescript=""',r.value=!1,m.push("/")},U=o(1),a=o({name:"",email:"",password:"",phone:"",birthday:"",address:{zipcode:0,detail:"",city:"",county:""}}),k=o(""),c=o({year:new Date().getFullYear(),month:1,day:1}),v=o(""),g=o(""),h=o(0),f=o(""),x=()=>{a.value.address.zipcode=h.value,a.value.address.city=v.value,a.value.address.county=g.value,a.value.address.detail=f.value,a.value.birthday=`${c.value.year}/${c.value.month}/${c.value.day}`,console.log(a.value.address,a.value.birthday);const s=`${n}/api/v1/user/signup`;l.post(s,a.value).then(e=>{console.log(e),a.value={name:"",email:"",password:"",phone:"",birthday:"",address:{zipcode:0,detail:"",city:"",county:""}},U.value=1,k.value="",f.value="",v.value="",g.value="",h.value=0,m.push("/login")}).catch(e=>{console.log(e),alert(e.response.data.message)})},r=o(!1),A=async()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)typescript\s*=\s*([^;]*).*$)|^.*$/,"$1");l.defaults.headers.common.Authorization=s;const e=`${n}/api/v1/user/check`;try{const t=await l.get(e);r.value=t.data.status,console.log("checkUser 驗證成功",r.value),console.log(t)}catch{r.value=!1,console.log("checkUser 驗證失敗",r.value)}},i=o({userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""}),y=o(""),C=o(!1),P=o(!1),p=o(!1),S=async()=>{const s=`${n}/api/v1/user`;l.get(s).then(e=>{console.log("getUser 成功",e),u.value=e.data.result,p.value=e.data.status,console.log(p.value)}).catch(e=>{console.log("getUser 失敗",e),p.value=e.response.data.status,console.log(p.value)})},D=async()=>{if(i.value.newPassword!==y.value){alert("密碼不一致");return}const s=`${n}/api/v1/user`;l.put(s,i.value).then(e=>{console.log("修改資料 成功",e),u.value=e.data.result,C.value=!1,$.fire({icon:"success",title:"修改資料成功"}),i.value={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""},y.value=""}).catch(e=>{console.log("login 失敗",e),b.fire({icon:"error",title:"修改資料失敗"})})},L=async()=>{const s={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""}};s.userId=i.value.userId,s.name=i.value.name,s.phone=i.value.phone,s.birthday=`${c.value.year}/${c.value.month}/${c.value.day}`,s.address.zipcode=h.value,s.address.detail=`${v.value}${g.value}${f.value}`,console.log(s);const e=`${n}/api/v1/user`;l.put(e,s).then(t=>{console.log("修改資料 成功",t),u.value=t.data.result,P.value=!1,$.fire({icon:"success",title:"修改資料成功"})}).catch(t=>{console.log("修改資料失敗",t),b.fire({icon:"error",title:"修改資料失敗"})})},B=async()=>{d.fire({title:"請輸入您的Email",input:"text",inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:async s=>{console.log(s),T(s)},allowOutsideClick:()=>!d.isLoading()})},T=async s=>{const e=`${n}/api/v1/verify/generateEmailCode`;l.post(e,s).then(t=>{console.log("已將驗證信發送到您的信箱",t),d.fire({title:"已將驗證信發送到您的信箱",text:"請設定新密碼",icon:"success",preConfirm:()=>{d.fire({title:"請輸入新密碼及驗證碼",html:`
            <label for="swal-input1">請輸入驗證碼</label>
            <input id="swal-input1" class="swal2-input">
            <label for="swal-input2">請輸入新密碼</label>
            <input id="swal-input2" class="swal2-input" type="password">
          `,inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:()=>{const O=document.getElementById("swal-input1"),R=document.getElementById("swal-input2");console.log(R.value,O.value)},allowOutsideClick:()=>!d.isLoading()})}})}).catch(t=>{console.log("checkUser 驗證失敗",t),d.fire({title:"驗證失敗，請確認Email",text:t.response.data.message,icon:"error"})})};return{loginData:w,userInfo:u,rememberMe:z,login:I,logout:E,signupData:a,signupStep:U,passwordConfirm:k,birthdate:c,selectedCity:v,detailedAddress:f,selectedDistrict:g,selectedZip:h,signup:x,isChecked:r,checkUser:A,editUserData:i,newPassword2:y,showEditPassword:C,showEditUserInfo:P,userStatus:p,getUser:S,editUserPass:D,editUserInfo:L,verifyEmail:B,forgotPassword:async()=>{const s=`${n}/api/v1/user/forgot`;l.get(s,{}).then(e=>{console.log("checkUser 驗證成功",e),r.value=!0}).catch(e=>{console.log("checkUser 驗證失敗",e)})}}});export{Y as u};
