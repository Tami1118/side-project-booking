import{q as x,u as V,A as j,r,v as z,K as a}from"./index-6y3oVoyK.js";import{f as I}from"./format-ue8EY1kP.js";import{T as p,A as m}from"./swal-dnbtQsbR.js";var q={VITE_URL:"https://freyja-g4ow.onrender.com",BASE_URL:"/side-project-booking/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:s}=q,Q=x("order",()=>{const S=V(),y=j(),g=r(""),$=r({...{checkInDate:"",checkOutDate:"",peopleNum:0,roomId:{name:"",description:"",imageUrl:"",imageUrlList:[],areaInfo:"",bedInfo:"",maxPeople:0,price:0,facilityInfo:[{title:"平面電視",isProvide:!0},{title:"吹風機",isProvide:!0},{title:"冰箱",isProvide:!0},{title:"熱水壺",isProvide:!0},{title:"檯燈",isProvide:!0},{title:"衣櫃",isProvide:!0},{title:"除濕機",isProvide:!0},{title:"浴缸",isProvide:!0},{title:"書桌",isProvide:!0},{title:"音響",isProvide:!0}],amenityInfo:[{title:"衛生紙",isProvide:!0},{title:"拖鞋",isProvide:!0},{title:"沐浴用品",isProvide:!0},{title:"清潔用品",isProvide:!0},{title:"刮鬍刀",isProvide:!0},{title:"吊衣架",isProvide:!0},{title:"浴巾",isProvide:!0},{title:"刷牙用品",isProvide:!0},{title:"罐裝水",isProvide:!0},{title:"梳子",isProvide:!0}]},userInfo:{name:"",phone:"",email:"",address:{zipcode:0,detail:""}}}}),l=r({start:"",end:""}),i=r(2),c=r({name:"",phone:"",email:""}),f=r(""),O=r(""),u=r(!1),w=async()=>{const t={checkInDate:I.getLocalDateFormat(new Date(l.value.start)),checkOutDate:I.getLocalDateFormat(new Date(l.value.end)),peopleNum:i.value,roomId:S.params.id,userInfo:{name:c.value.name,phone:c.value.phone,email:c.value.email,address:{zipcode:parseInt(f.value),detail:O.value}}};try{u.value=!0;const e=`${s}/api/v1/orders/`,d=await a.post(e,t);console.log("createOrder 新增成功",d),u.value=!1,k(),y.push(`/booking-complete/${d.data.result._id}`),v(),p.fire({title:"已建立訂單",icon:"success"})}catch(e){console.log("createOrder 失敗",e),u.value=!1,m.fire({title:"請填寫正確格式",icon:"error"})}},v=()=>{l.value={start:"",end:""},i.value=2,c.value={name:"",phone:"",email:""},f.value="",O.value=""},o=r(null),F=async()=>{try{console.log("getFrontOrder 取得資料",o.value);const t=`${s}/api/v1/orders/${S.params.id}`,e=await a.get(t);o.value=e.data.result}catch(t){console.log("getFrontOrder 失敗",t)}},L=z(()=>o.value?I.getNightNum(o.value.checkInDate,o.value.checkOutDate)*o.value.roomId.price:0),h=r([]),M=async()=>{try{const t=`${s}/api/v1/orders/`,e=await a.get(t);h.value=e.data.result}catch{}},_=t=>{const e=`${s}/api/v1/orders/${t}`;a.delete(e).then(()=>{M(),p.fire({icon:"success",title:"成功刪除訂單"})}).catch(()=>{m.fire({icon:"error",title:"請重新再試一次"})})},P=()=>{const t=`${s}/api/v1/admin/orders/`;a.get(t).then(e=>{console.log("getOrder 訂單列表",e),h.value=e.data.result}).catch(e=>{console.log(e)})},N=()=>{const t=`${s}/api/v1/admin/orders/${g.value}`;a.put(t,$.value).then(e=>{console.log("editOrder 更新成功",e),p.fire({icon:"success",title:"更新訂單成功"}),P()}).catch(e=>{console.log("editOrder 失敗",e),m.fire({icon:"error",title:"更新失敗，請稍後再試一次"})})},R=()=>{const t=`${s}/api/v1/admin/orders/${g.value}`;a.delete(t).then(e=>{console.log("deleteOrder 刪除成功",e),p.fire({icon:"success",title:"成功刪除訂單"}),P()}).catch(e=>{console.log("deleteOrder 失敗",e),m.fire({icon:"error",title:"刪除失敗，請稍後再試一次"})})},b=()=>{localStorage.setItem("storagePeople",i.value.toString())},E=()=>{const t=localStorage.getItem("storageDate"),e=JSON.parse(t),d=localStorage.getItem("storagePeople");e&&d&&(l.value=e,i.value=Number(d))},k=()=>{localStorage.clear()},n=r(!1),T=()=>{n.value=!0},U=()=>{n.value=!1,v()},A=()=>{n.value=!n.value},D=r(!1);return{tempOrder:$,resetTempOrder:v,editOrderId:g,bookingDate:l,peopleNum:i,userInfo:c,selectDistrict:f,addressDetail:O,isLoading:u,orderList:h,getFrontOrder:F,createOrder:w,order:o,getFrontOrders:M,totalPrice:L,deleteFrontOrder:_,getOrders:P,editOrder:N,deleteOrder:R,setStoragePeople:b,getStorageData:E,cleanStorageData:k,showOrderModal:n,openOrderModal:T,closeOrderModal:U,toogleModal:A,showDelModal:D,openOrderDelModal:()=>{D.value=!0},closeOrderDelModal:()=>{D.value=!1,v()}}});export{Q as u};
