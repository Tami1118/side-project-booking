import{q as L,r as v,s as V,b as C,e as d,f,g as e,t as x,c as t,h as w,i as z,n as j,k as M,d as B,j as b,N as U,o as E,F as q,m as I,p as A}from"./index-5zW-ksle.js";import{a as N,T as F,A as D}from"./userApi--yMtzZvb.js";import{u as R}from"./userStore-YZvPMcI4.js";const O=L("newsStore",()=>{const k={title:"",description:"",image:""},n=v(JSON.parse(JSON.stringify(k))),r=()=>{n.value=JSON.parse(JSON.stringify(k))},o=v(null),u=async()=>{try{console.log("getNews");const s=await N.get("/admin/news/");o.value=s.data.result,console.log("getNews 已取得",s)}catch(s){console.log("getNews 取得失敗",s)}},g=async()=>{try{const s=await N.post("/admin/news/",n.value);console.log("createNews 已新增",s),F.fire({icon:"success",title:`已新增 ${s.data.result.title}`}),u()}catch(s){console.log("createNews 新增失敗",s),D.fire({icon:"error",title:"新增失敗，請稍後再試一次"})}},l=v(""),p=v(""),a=async()=>{try{const s=await N.put(`/admin/news/${p.value}`,n.value);console.log("editNews 已更新",s),F.fire({icon:"success",title:`${s.data.result.title} 已更新`}),u()}catch(s){console.log("editNews 更新失敗",s),D.fire({icon:"error",title:"更新失敗，請稍後再試一次"})}},h=async()=>{try{await N.delete(`/admin/news/${p.value}`),console.log("deleteNews 已刪除"),F.fire({icon:"success",title:"已刪除"}),u()}catch(s){console.log("deleteNews 刪除失敗",s),D.fire({icon:"error",title:"刪除失敗，請稍後再試一次"})}},y=async()=>{try{const s=await N.get("/home/news/");console.log("getFrontNews 已取得消息",s),o.value=s.data.result}catch(s){console.log("getFrontNews 失敗",s)}},$=async()=>{try{const s=await N.get(`/home/news/${p.value}`);n.value=s.data.result,console.log("getFrontOneNews 已取得單一消息",s)}catch(s){console.log(s)}},c=v(!1),m=()=>{c.value=!0},J=()=>{c.value=!1,r()},S=()=>{c.value=!c.value},_=v(!1);return{tempNews:n,resetTempNews:r,newsList:o,getNews:u,createNews:g,updateNewsType:l,editNewsId:p,editNews:a,deleteNews:h,getFrontNews:y,getFrontOneNews:$,showNewsModal:c,openNewsModal:m,closeNewsModal:J,toggleModal:S,showDelModal:_,openNewsDelModal:()=>{_.value=!0},closeNewsDelModal:()=>{_.value=!1,r()}}}),G={class:"fixed top-0 left-0 w-full h-full bg-neutral-100/50 backdrop-blur-sm flex justify-center items-center"},H={"data-aos":"fade-up","data-aos-delay":"50","data-aos-duration":"300",class:"bg-white w-full md:w-2/3 xl:w-1/3 h-full md:h-fit md:max-h-[80vh] xl:max-h-[70vh] md:rounded-4 overflow-scroll duration-500 ease-in"},K={class:"sticky top-0 px-5 py-4 z-10 border-b border-primary flex justify-between bg-primary-40 text-primary"},P={class:"text-5"},Q={class:"p-4 flex flex-col gap-4"},W=e("label",{for:"news-title",class:"font-bold"},"名稱",-1),X=e("label",{for:"news-description",class:"font-bold"},"內容",-1),Y=e("label",{for:"news-image",class:"font-bold"},"圖片",-1),Z=["src"],ee={class:"bg-white sticky bottom-0 z-10 border-t border-primary-60 p-4 flex gap-2 justify-end"},te={type:"submit",class:"btn btn-primary"},se={__name:"NewsModal",setup(k){const n=O(),{updateNewsType:r,tempNews:o}=V(n),u=n.createNews,g=n.editNews,l=n.closeNewsModal;return(p,a)=>{const h=C("VField"),y=C("ErrorMessage"),$=C("VForm");return d(),f("div",G,[e("div",H,[e("div",K,[e("h1",P,x(t(r)==="create"?"新增":"編輯")+"消息",1),e("span",{class:"material-icons cursor-pointer",onClick:a[0]||(a[0]=c=>t(l)())},"close")]),w($,{class:"flex flex-col",onSubmit:a[5]||(a[5]=c=>(t(r)==="create"?t(u)():t(g)(),t(l)()))},{default:z(({errors:c})=>[e("div",Q,[e("div",null,[W,w(h,{type:"text",id:"news-title",name:"名稱",class:j([{"is-invalid":c.名稱},"form-input"]),rules:"required",modelValue:t(o).title,"onUpdate:modelValue":a[1]||(a[1]=m=>t(o).title=m),placeholder:"請輸入名稱"},null,8,["class","modelValue"]),w(y,{name:"名稱",class:"text-alert-100 text-3h"})]),e("div",null,[X,w(h,{as:"textarea",id:"news-description",name:"內容",class:j([{"is-invalid":c.內容},"form-input"]),rules:"required",modelValue:t(o).description,"onUpdate:modelValue":a[2]||(a[2]=m=>t(o).description=m),placeholder:"請輸入內容"},null,8,["class","modelValue"]),w(y,{name:"內容",class:"text-alert-100 text-3h"})]),e("div",null,[Y,w(h,{type:"text",id:"news-image",name:"圖片",class:j([{"is-invalid":c.圖片},"form-input"]),rules:"required",modelValue:t(o).image,"onUpdate:modelValue":a[3]||(a[3]=m=>t(o).image=m),placeholder:"請輸入圖片連結"},null,8,["class","modelValue"]),w(y,{name:"圖片",class:"text-alert-100 text-3h"}),t(o).image?(d(),f("img",{key:0,src:t(o).image,class:"mt-2 rounded-2 h-[200px] w-full object-cover",alt:""},null,8,Z)):M("",!0)])]),e("div",ee,[e("button",{type:"button",class:"btn btn-secondary",onClick:a[4]||(a[4]=m=>t(l)())},"取消"),e("button",te,"確認"+x(t(r)==="create"?"新增":"更新"),1)])]),_:1})])])}}},oe={class:"w-full h-[30vh] lg:h-[24vh] flex justify-center items-center px-6"},le={class:"text-5 font-bold text-justify"},ne={class:"text-primary-100"},ae={class:"p-3 flex gap-4 border-t border-primary-60"},re=B({__name:"NewsDelete",setup(k){const n=O(),{tempNews:r}=V(n),o=n.closeNewsDelModal,u=n.deleteNews;return(g,l)=>(d(),f("div",{onClick:l[3]||(l[3]=U(p=>t(o)(),["stop"])),class:"fixed top-0 left-0 w-full h-full bg-black/40 backdrop-blur-sm flex justify-center items-end lg:items-center"},[e("div",{onClick:l[2]||(l[2]=U(()=>{},["stop"])),class:"bg-white rounded-t-[16px] lg:rounded-[16px] w-full lg:w-[36vw]"},[e("div",oe,[e("p",le,[b(" 刪除後無法復原，確定要刪除 "),e("span",ne,x(t(r).title),1),b(" 嗎？ ")])]),e("div",ae,[e("button",{class:"btn btn-secondary w-full",onClick:l[0]||(l[0]=p=>t(o)())},"關閉視窗"),e("button",{class:"btn btn-primary w-full",onClick:l[1]||(l[1]=p=>(t(u)(),t(o)()))},"刪除")])])]))}}),ce={class:"p-10 flex flex-col gap-6"},ie={class:"flex items-end"},de=e("h1",{class:"text-7"},"消息管理",-1),ue={key:0,class:"font-bold ms-2"},pe={class:"text-primary-100"},we={key:0,class:"text-primary-100 text-7 font-bold w-full h-[70vh] flex justify-center items-center"},me={key:1,class:"w-full admin-table"},fe=e("thead",null,[e("tr",{class:"border-y border-primary-60"},[e("th",{class:"text-start",width:"15%"}),e("th",{class:"text-center",width:"20%"},"名稱"),e("th",{class:"text-center",width:"30%"},"內容"),e("th",{class:"text-center",width:"25%"},"管理")])],-1),he=["src","alt"],_e={class:"text-center"},be={class:"text-justify"},ge={class:"flex flex-wrap justify-center gap-2"},ye=["onClick"],ve=["onClick"],$e=B({__name:"NewsAdmin",setup(k){const n=O(),{newsList:r,tempNews:o,editNewsId:u,updateNewsType:g,showNewsModal:l,showDelModal:p}=V(n),a=n.getNews,h=R(),{isChecked:y}=V(h),$=h.checkUser,c=()=>{y.value&&a()},m=async()=>{await $(),c()};return E(()=>{m()}),(J,S)=>{const _=C("font-awesome-icon");return d(),f(q,null,[e("div",ce,[e("div",ie,[de,t(r)?(d(),f("p",ue,[b("(共 "),e("span",pe,x(t(r).length),1),b(" 筆資料)")])):M("",!0)]),e("button",{class:"btn btn-primary ms-auto",onClick:S[0]||(S[0]=i=>(l.value=!0,g.value="create"))},[w(_,{icon:"fa-solid fa-plus",class:"me-2"}),b(" 新增消息 ")]),t(r)?(d(),f("table",me,[fe,e("tbody",null,[(d(!0),f(q,null,I(t(r),i=>(d(),f("tr",{key:i._id,class:"border-b border-primary-60 hover:bg-primary-40"},[e("th",null,[i.image?(d(),f("img",{key:0,class:"w-full h-[120px] object-cover rounded-2",src:i.image,alt:i.title},null,8,he)):M("",!0)]),e("th",_e,x(i.title),1),e("th",be,x(i.description),1),e("th",null,[e("div",ge,[e("button",{onClick:T=>(l.value=!0,o.value=JSON.parse(JSON.stringify(i)),g.value="edit",u.value=i._id),class:"btn btn-primary text-4h"},[w(_,{icon:"fa-solid fa-pencil",class:"me-2"}),b(" 編輯 ")],8,ye),e("button",{onClick:T=>(p.value=!0,o.value=JSON.parse(JSON.stringify(i)),u.value=i._id),class:"btn text-primary-100 text-4h hover:text-primary border border-primary-100 hover:border-primary bg-transparent hover:bg-primary-60"},[w(_,{icon:"fa-solid fa-trash-can",class:"me-2"}),b(" 刪除 ")],8,ve)])])]))),128))])])):(d(),f("div",we,[w(_,{icon:"fa-solid fa-bullhorn",class:"me-2"}),b(" 目前還沒有任何消息，快去新增吧！ ")]))]),t(l)?(d(),A(se,{key:0})):M("",!0),t(p)?(d(),A(re,{key:1})):M("",!0)],64)}}});export{$e as default};
