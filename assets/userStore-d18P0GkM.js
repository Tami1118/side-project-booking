import{v as j,B as q,r as t,q as o}from"./index-ZqzRWSCL.js";import{T as g,A as w,S as i}from"./swal-Imie3hvR.js";const n="https://freyja-g4ow.onrender.com",V=j("userStore",()=>{const y=q(),$=t({email:"",password:""}),u=t({}),z=t(!1),I=()=>{const s=`${n}/api/v1/user/login`;o.post(s,$.value).then(e=>{const{token:a}=e.data;document.cookie=`typescript=${a}`,o.defaults.headers.common.Authorization=a,u.value=e.data.result,$.value={email:"",password:""},g.fire({icon:"success",title:"登入成功"}),y.push("/")}).catch(()=>{w.fire({icon:"error",title:"登入失敗",text:"格式有誤，請重新登入"})})},E=()=>{document.cookie='typescript=""',d.value=!1,g.fire({icon:"success",title:"已登出"}),y.push("/")},U=t(1),l=t({name:"",email:"",password:"",phone:"",birthday:"",address:{zipcode:0,detail:"",city:"",county:""}}),k=t(""),r=t({year:new Date().getFullYear(),month:1,day:1}),v=t(""),h=t(""),f=t(0),m=t(""),x=()=>{l.value.address.zipcode=f.value,l.value.address.city=v.value,l.value.address.county=h.value,l.value.address.detail=m.value,l.value.birthday=`${r.value.year}/${r.value.month}/${r.value.day}`;const s=`${n}/api/v1/user/signup`;o.post(s,l.value).then(e=>{console.log(e),l.value={name:"",email:"",password:"",phone:"",birthday:"",address:{zipcode:0,detail:"",city:"",county:""}},U.value=1,k.value="",m.value="",v.value="",h.value="",f.value=0,y.push("/login"),w.fire({title:"註冊成功，請登入會員",icon:"success"})}).catch(e=>{console.log(e),alert(e.response.data.message)})},d=t(!1),A=async()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)typescript\s*=\s*([^;]*).*$)|^.*$/,"$1");o.defaults.headers.common.Authorization=s;const e=`${n}/api/v1/user/check`;try{const a=await o.get(e);d.value=a.data.status}catch{d.value=!1}},c=t({userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""}),b=t(""),C=t(!1),P=t(!1),p=t(!1),S=async()=>{const s=`${n}/api/v1/user`;o.get(s).then(e=>{console.log("getUser 成功",e),u.value=e.data.result,p.value=e.data.status,console.log(p.value)}).catch(e=>{console.log("getUser 失敗",e),p.value=e.response.data.status,console.log(p.value)})},D=async()=>{if(c.value.newPassword!==b.value){alert("密碼不一致");return}const s=`${n}/api/v1/user`;o.put(s,c.value).then(e=>{console.log("修改資料 成功",e),u.value=e.data.result,C.value=!1,g.fire({icon:"success",title:"修改資料成功"}),c.value={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""},oldPassword:"",newPassword:""},b.value=""}).catch(e=>{console.log("login 失敗",e),w.fire({icon:"error",title:"修改資料失敗"})})},B=async()=>{const s={userId:"",name:"",phone:"",birthday:"",address:{zipcode:0,detail:""}};s.userId=c.value.userId,s.name=c.value.name,s.phone=c.value.phone,s.birthday=`${r.value.year}/${r.value.month}/${r.value.day}`,s.address.zipcode=f.value,s.address.detail=`${v.value}${h.value}${m.value}`,console.log(s);const e=`${n}/api/v1/user`;o.put(e,s).then(a=>{console.log("修改資料 成功",a),u.value=a.data.result,P.value=!1,g.fire({icon:"success",title:"修改資料成功"})}).catch(a=>{console.log("修改資料失敗",a),w.fire({icon:"error",title:"修改資料失敗"})})},L=async()=>{i.fire({title:"請輸入您的Email",input:"text",inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:async s=>{console.log(s),T(s)},allowOutsideClick:()=>!i.isLoading()})},T=async s=>{const e=`${n}/api/v1/verify/generateEmailCode`;o.post(e,s).then(a=>{console.log("已將驗證信發送到您的信箱",a),i.fire({title:"已將驗證信發送到您的信箱",text:"請設定新密碼",icon:"success",preConfirm:()=>{i.fire({title:"請輸入新密碼及驗證碼",html:`
            <label for="swal-input1">請輸入驗證碼</label>
            <input id="swal-input1" class="swal2-input">
            <label for="swal-input2">請輸入新密碼</label>
            <input id="swal-input2" class="swal2-input" type="password">
          `,inputAttributes:{autocapitalize:"off"},confirmButtonText:"送出",showLoaderOnConfirm:!0,preConfirm:()=>{const O=document.getElementById("swal-input1"),R=document.getElementById("swal-input2");console.log(R.value,O.value)},allowOutsideClick:()=>!i.isLoading()})}})}).catch(a=>{console.log("checkUser 驗證失敗",a),i.fire({title:"驗證失敗，請確認Email",text:a.response.data.message,icon:"error"})})};return{loginData:$,userInfo:u,rememberMe:z,login:I,logout:E,signupData:l,signupStep:U,passwordConfirm:k,birthdate:r,selectedCity:v,detailedAddress:m,selectedDistrict:h,selectedZip:f,signup:x,isChecked:d,checkUser:A,editUserData:c,newPassword2:b,showEditPassword:C,showEditUserInfo:P,userStatus:p,getUser:S,editUserPass:D,editUserInfo:B,verifyEmail:L,forgotPassword:async()=>{const s=`${n}/api/v1/user/forgot`;o.get(s,{}).then(e=>{console.log("checkUser 驗證成功",e),d.value=!0}).catch(e=>{console.log("checkUser 驗證失敗",e)})}}});export{V as u};
