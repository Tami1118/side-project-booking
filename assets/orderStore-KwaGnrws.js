import{q as P,u as T,A as b,r,v as A,K as a}from"./index-Bx7n4dr3.js";import{f as v}from"./format-ue8EY1kP.js";import{T as I,A as S}from"./swal-VkHh6Fna.js";var U={VITE_URL:"https://freyja-g4ow.onrender.com",BASE_URL:"/side-project-booking/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:s}=U,q=P("order",()=>{const i=T(),$=b(),k=r({...{checkInDate:"",checkOutDate:"",peopleNum:0,roomId:"",userInfo:{name:"",phone:"",email:"",address:{zipcode:0,detail:""}}}}),n=r({start:"",end:""}),l=r(2),u=r({name:"",phone:"",email:""}),p=r(""),m=r(""),d=r(!1),_=async()=>{const t={checkInDate:v.getLocalDateFormat(new Date(n.value.start)),checkOutDate:v.getLocalDateFormat(new Date(n.value.end)),peopleNum:l.value,roomId:i.params.id,userInfo:{name:u.value.name,phone:u.value.phone,email:u.value.email,address:{zipcode:parseInt(p.value),detail:m.value}}};try{d.value=!0;const e=`${s}/api/v1/orders/`,o=await a.post(e,t);d.value=!1,O(),$.push(`/booking-complete/${o.data.result._id}`),f(),I.fire({title:"已建立訂單",icon:"success"})}catch{d.value=!1,S.fire({title:"請填寫正確格式",icon:"error"})}},f=()=>{n.value={start:"",end:""},l.value=2,u.value={name:"",phone:"",email:""},p.value="",m.value=""},c=r(null),y=async()=>{try{const t=`${s}/api/v1/orders/${i.params.id}`,e=await a.get(t);c.value=e.data.result}catch{}},L=A(()=>c.value?v.getNightNum(c.value.checkInDate,c.value.checkOutDate)*c.value.roomId.price:0),g=r([]),h=async()=>{try{const t=`${s}/api/v1/orders/`,e=await a.get(t);g.value=e.data.result}catch{}},N=t=>{const e=`${s}/api/v1/orders/${t}`;a.delete(e).then(()=>{h(),I.fire({icon:"success",title:"成功刪除訂單"})}).catch(()=>{S.fire({icon:"error",title:"請重新再試一次"})})},D=()=>{const t=`${s}/api/v1/admin/orders/`;a.get(t).then(e=>{console.log("getOrder 訂單列表",e),g.value=e.data.result}).catch(e=>{console.log(e)})},R=t=>{const e=`${s}/api/v1/admin/orders/${i.params.id}`;a.put(e,t).then(o=>{console.log(o)}).catch(o=>{console.log(o)})},w=t=>{const e=`${s}/api/v1/admin/orders/${t}`;a.delete(e).then(o=>{console.log("刪除成功",o),D()}).catch(o=>{console.log(o)})},F=()=>{localStorage.setItem("storagePeople",l.value.toString())},E=()=>{const t=localStorage.getItem("storageDate"),e=JSON.parse(t),o=localStorage.getItem("storagePeople");e&&o&&(n.value=e,l.value=Number(o))},O=()=>{localStorage.clear()};return{bookingDate:n,peopleNum:l,userInfo:u,selectDistrict:p,addressDetail:m,tempOrder:k,isLoading:d,createOrder:_,orderList:g,getFrontOrder:y,order:c,getFrontOrders:h,totalPrice:L,deleteFrontOrder:N,resetTempOrder:f,getOrders:D,editOrder:R,deleteOrder:w,setStoragePeople:F,getStorageData:E,cleanStorageData:O}});export{q as u};
